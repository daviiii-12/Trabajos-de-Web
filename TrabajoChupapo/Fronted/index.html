<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control de Pr√©stamos | Acceso</title>

  <link rel="stylesheet" href="./assets/css/main.css" />
  <link rel="stylesheet" href="./assets/css/responsive.css" />
</head>

<body>
  <!-- Topbar -->
  <header class="topbar">
    <div class="container">
      <div class="brand">
        <div class="brand-badge" aria-hidden="true"></div>
        <div>
          <h1>Control de Pr√©stamos</h1>
          <p>Ingreso al sistema</p>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="grid-2">
      <!-- Info -->
      <div class="card soft">
        <h2 class="card-title">Recaudo en l√≠nea</h2>
        <p class="card-subtitle">
          Sistema para gestionar pr√©stamos, cartera y abonos con trazabilidad.
          Accede desde celular o computador.
        </p>

        <div class="mt-3 stack">
          <div class="badge warn">üîí Los cambios cr√≠ticos requieren aprobaci√≥n del Administrador</div>
          <div class="badge">üìä Cartera vigente / vencida / asignada (con colores)</div>
          <div class="small">
            Inicia sesi√≥n con tu <strong>correo</strong> y <strong>contrase√±a</strong>.
            El sistema detecta tu rol autom√°ticamente.
          </div>
        </div>
      </div>

      <!-- Login form (INMEDIATO) -->
      <div class="card">
        <h2 class="card-title">Iniciar sesi√≥n</h2>
        <p class="card-subtitle">Escribe tus datos para entrar.</p>

        <form id="loginForm" class="mt-3 stack" novalidate>
          <div class="field">
            <label class="label" for="email">Correo</label>
            <input class="input" id="email" name="email" type="email" placeholder="ej: usuario@correo.com" autocomplete="username" required />
            <div class="help">Debe ser el correo registrado en el sistema.</div>
          </div>

          <div class="field">
            <label class="label" for="password">Contrase√±a</label>
            <input class="input" id="password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required />
            <div class="help">No compartas tu contrase√±a.</div>
          </div>

          <div class="badge" id="msg" style="display:none;"></div>

          <button class="btn primary" type="submit">üîê Entrar</button>

          <p class="small">
            Demo: sin backend. (Luego se valida con servidor y se retorna el rol real).
          </p>
        </form>
      </div>
    </section>

    <section class="mt-3 center">
      <p class="small">
        ¬© <span id="year"></span> Control de Pr√©stamos ‚Äî Demo Frontend
      </p>
    </section>
  </main>

  <script src="./assets/js/auth.js"></script>
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // UI helpers
    const msg = document.getElementById("msg");
    const showMsg = (text, type = "warn") => {
      msg.style.display = "inline-flex";
      msg.className = "badge " + (type === "ok" ? "ok" : "warn");
      msg.textContent = text;
    };
    const hideMsg = () => {
      msg.style.display = "none";
      msg.textContent = "";
    };

    // Demo role detection:
    // - si el correo contiene "admin" => admin
    // - si no => cobrador
    // (cuando haya backend, esto se reemplaza por la respuesta del servidor)
    const detectRoleByEmail = (email) => {
      const e = (email || "").trim().toLowerCase();
      if (e.includes("admin")) return "admin";
      return "cobrador";
    };

    document.getElementById("loginForm").addEventListener("submit", (ev) => {
      ev.preventDefault();
      hideMsg();

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!email || !password) {
        showMsg("Completa correo y contrase√±a.", "warn");
        return;
      }

      const role = detectRoleByEmail(email);

      Auth.setUsername(email); // por ahora guardamos el correo como username
      Auth.setRole(role);

      Auth.go(role === "admin" ? "./admin.html" : "./cobrador.html");
    });
  </script>
</body>
</html>
