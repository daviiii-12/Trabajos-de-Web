<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control de Pr√©stamos | Login</title>

  <!-- CSS -->
  <link rel="stylesheet" href="./assets/css/main.css" />
  <link rel="stylesheet" href="./assets/css/responsive.css" />
</head>

<body>
  <!-- Topbar -->
  <header class="topbar">
    <div class="container">
      <div class="row between">
        <a class="brand" href="./index.html" aria-label="Volver al inicio">
          <div class="brand-badge" aria-hidden="true"></div>
          <div>
            <h1>Control de Pr√©stamos</h1>
            <p id="roleSubtitle">Inicia sesi√≥n</p>
          </div>
        </a>

        <span class="badge" id="roleBadge">Rol</span>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="grid-2">
      <!-- Info -->
      <div class="card soft">
        <h2 class="card-title">Acceso seguro</h2>
        <p class="card-subtitle">
          Ingresa con tu usuario y contrase√±a. Los permisos dependen del rol:
          el cobrador no puede editar datos cr√≠ticos.
        </p>

        <div class="mt-3 stack">
          <div class="badge warn">
            üßæ Si hay errores en porcentaje o monto, se solicita correcci√≥n al administrador
          </div>
          <div class="small">
            Si elegiste el rol equivocado, vuelve atr√°s y selecciona el correcto.
          </div>
        </div>
      </div>

      <!-- Form -->
      <div class="card">
        <h2 class="card-title">Iniciar sesi√≥n</h2>
        <p class="card-subtitle">Completa tus datos para continuar.</p>

        <form id="loginForm" class="mt-3 stack" novalidate>
          <div class="field">
            <label class="label" for="username">Usuario</label>
            <input class="input" id="username" name="username" type="text" placeholder="Ej: cobrador1" autocomplete="username" />
            <div class="help">Escribe tu usuario asignado.</div>
          </div>

          <div class="field">
            <label class="label" for="password">Contrase√±a</label>
            <input class="input" id="password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
            <div class="help">No compartas tu contrase√±a.</div>
          </div>

          <div class="badge" id="msg" style="display:none;"></div>

          <button class="btn primary" type="submit">
            üîê Entrar
          </button>

          <button class="btn ghost" id="backBtn" type="button">
            ‚Üê Volver a elegir rol
          </button>

          <p class="small">
            Demo: sin backend a√∫n, solo valida que no est√© vac√≠o y redirige.
          </p>
        </form>
      </div>
    </section>
  </main>

  <!-- Auth helper -->
  <script src="./assets/js/auth.js"></script>

  <script>
    // Si no hay rol, devolvemos al inicio
    const role = Auth.getRole();
    if (!role) Auth.go("./index.html");

    const roleBadge = document.getElementById("roleBadge");
    const roleSubtitle = document.getElementById("roleSubtitle");

    const roleText = role === "admin" ? "Administrador" : "Cobrador";
    roleBadge.textContent = "Rol: " + roleText;
    roleSubtitle.textContent = "Inicia sesi√≥n como " + roleText;

    // UI helpers
    const msg = document.getElementById("msg");
    const showMsg = (text, type = "warn") => {
      msg.style.display = "inline-flex";
      msg.className = "badge " + (type === "ok" ? "ok" : "warn");
      msg.textContent = text;
    };
    const hideMsg = () => {
      msg.style.display = "none";
      msg.textContent = "";
    };

    // Back button
    document.getElementById("backBtn").addEventListener("click", () => {
      Auth.clearRole();
      Auth.go("./index.html");
    });

    // Form submit (demo)
    document.getElementById("loginForm").addEventListener("submit", (e) => {
      e.preventDefault();
      hideMsg();

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username || !password) {
        showMsg("Completa usuario y contrase√±a.", "warn");
        return;
      }

      // Guardamos usuario (luego esto lo valida el backend)
      Auth.setUsername(username);

      // Redirigir seg√∫n rol
      Auth.go(role === "admin" ? "./admin.html" : "./cobrador.html");
    });
  </script>
</body>
</html>
